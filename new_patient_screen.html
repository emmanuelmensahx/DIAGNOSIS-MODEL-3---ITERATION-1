<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AfriDiag - New Patient</title>
    <link rel="stylesheet" href="css/navigation.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background-color: #f5f5f5;
            color: #333;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: white;
            min-height: 100vh;
            padding-bottom: 80px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(135deg, #4CAF50, #66BB6A);
            color: white;
            border-radius: 10px;
        }
        
        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }
        
        .header p {
            font-size: 16px;
            opacity: 0.9;
        }
        
        .form-section {
            margin-bottom: 30px;
            padding: 25px;
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            background-color: #fafafa;
        }
        
        .section-title {
            color: #4CAF50;
            margin-bottom: 20px;
            font-size: 20px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
            border-bottom: 2px solid #e8f5e8;
            padding-bottom: 10px;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }
        
        .required {
            color: #f44336;
        }
        
        .form-group input, 
        .form-group textarea, 
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        .form-group input:focus, 
        .form-group textarea:focus, 
        .form-group select:focus {
            outline: none;
            border-color: #4CAF50;
        }
        
        .form-group input.error,
        .form-group select.error {
            border-color: #f44336;
        }
        
        .error-message {
            color: #f44336;
            font-size: 14px;
            margin-top: 5px;
            display: none;
        }
        
        .checkbox-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }
        
        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px;
            background-color: white;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            transition: background-color 0.3s;
        }
        
        .checkbox-item:hover {
            background-color: #f0f8ff;
        }
        
        .checkbox-item input[type="checkbox"] {
            width: auto;
            margin: 0;
        }
        
        .radio-group {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            margin-top: 10px;
        }
        
        .radio-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .radio-item input[type="radio"] {
            width: auto;
            margin: 0;
        }
        
        .photo-upload {
            border: 2px dashed #4CAF50;
            border-radius: 8px;
            padding: 30px;
            text-align: center;
            background-color: #f0f8ff;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .photo-upload:hover {
            background-color: #e6f3ff;
        }
        
        .photo-upload input[type="file"] {
            display: none;
        }
        
        .photo-preview {
            margin-top: 15px;
            text-align: center;
        }
        
        .photo-preview img {
            max-width: 150px;
            max-height: 150px;
            border-radius: 8px;
            border: 2px solid #e0e0e0;
        }
        
        .emergency-contact {
            background-color: #fff3e0;
            border-left: 4px solid #FF9800;
        }

        /* Symptoms Section Styling */
        .symptoms-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 15px;
        }

        .symptom-category {
            background-color: white;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 15px;
        }

        .symptom-category h4 {
            color: #4CAF50;
            margin-bottom: 12px;
            font-size: 16px;
            font-weight: 600;
            border-bottom: 1px solid #e8f5e8;
            padding-bottom: 8px;
        }

        .symptom-category .checkbox-item {
            margin-bottom: 8px;
            padding: 8px 10px;
            background-color: #fafafa;
            border: 1px solid #f0f0f0;
            border-radius: 4px;
            transition: all 0.3s ease;
        }

        .symptom-category .checkbox-item:hover {
            background-color: #e8f5e8;
            border-color: #4CAF50;
        }

        .symptom-category .checkbox-item input[type="checkbox"]:checked + label {
            color: #4CAF50;
            font-weight: 600;
        }

        /* Severity Slider Styling */
        .form-group input[type="range"] {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: #e0e0e0;
            outline: none;
            -webkit-appearance: none;
        }

        .form-group input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #4CAF50;
            cursor: pointer;
            border: 2px solid white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .form-group input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #4CAF50;
            cursor: pointer;
            border: 2px solid white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .severity-labels {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 8px;
            font-size: 14px;
            color: #666;
        }

        .severity-labels #severityValue {
            background-color: #4CAF50;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-weight: 600;
        }

        /* Diagnosis Request Checkbox */
        .form-group label input[type="checkbox"] {
            width: auto;
            margin-right: 8px;
            transform: scale(1.2);
        }
        
        .submit-section {
            text-align: center;
            margin-top: 30px;
        }
        
        .submit-btn {
            padding: 15px 40px;
            background: linear-gradient(135deg, #4CAF50, #66BB6A);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
            margin-right: 15px;
        }
        
        .submit-btn:hover {
            transform: translateY(-2px);
        }
        
        .submit-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }
        
        .cancel-btn {
            padding: 15px 40px;
            background: #757575;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
            text-decoration: none;
            display: inline-block;
        }
        
        .cancel-btn:hover {
            transform: translateY(-2px);
            background: #616161;
        }
        
        .navigation {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            border-top: 1px solid #e0e0e0;
            display: flex;
            justify-content: space-around;
            padding: 10px 0;
        }
        
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            padding: 10px;
            text-decoration: none;
            color: #757575;
            transition: color 0.3s;
        }
        
        .nav-item.active {
            color: #4CAF50;
        }
        
        .nav-item:hover {
            color: #4CAF50;
        }
        
        .nav-icon {
            font-size: 24px;
        }
        
        .nav-text {
            font-size: 12px;
        }
        
        .progress-indicator {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
        }
        
        .progress-step {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background-color: #e0e0e0;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin: 0 10px;
            position: relative;
        }
        
        .progress-step.active {
            background-color: #4CAF50;
        }
        
        .progress-step.completed {
            background-color: #2196F3;
        }
        
        .progress-step::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 100%;
            width: 20px;
            height: 2px;
            background-color: #e0e0e0;
            transform: translateY(-50%);
        }
        
        .progress-step:last-child::after {
            display: none;
        }
        
        .progress-step.completed::after {
            background-color: #4CAF50;
        }
        
        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .radio-group {
                flex-direction: column;
                gap: 10px;
            }
            
            .submit-section {
                display: flex;
                flex-direction: column;
                gap: 15px;
            }
            
            .submit-btn, .cancel-btn {
                width: 100%;
                margin: 0;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>➕ New Patient Registration</h1>
            <p>Add a new patient to the system</p>
        </div>

        <!-- Progress Indicator -->
        <div class="progress-indicator">
            <div class="progress-step active">1</div>
            <div class="progress-step">2</div>
            <div class="progress-step">3</div>
            <div class="progress-step">4</div>
        </div>

        <form id="newPatientForm" onsubmit="submitForm(event)">
            <!-- Personal Information -->
            <div class="form-section">
                <h2 class="section-title">👤 Personal Information</h2>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="firstName">First Name <span class="required">*</span></label>
                        <input type="text" id="firstName" name="firstName" required>
                        <div class="error-message" id="firstNameError">First name is required</div>
                    </div>
                    <div class="form-group">
                        <label for="lastName">Last Name <span class="required">*</span></label>
                        <input type="text" id="lastName" name="lastName" required>
                        <div class="error-message" id="lastNameError">Last name is required</div>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="dateOfBirth">Date of Birth <span class="required">*</span></label>
                        <input type="date" id="dateOfBirth" name="dateOfBirth" required>
                        <div class="error-message" id="dateOfBirthError">Date of birth is required</div>
                    </div>
                    <div class="form-group">
                        <label for="age">Age</label>
                        <input type="number" id="age" name="age" readonly>
                    </div>
                </div>

                <div class="form-group">
                    <label>Gender <span class="required">*</span></label>
                    <div class="radio-group">
                        <div class="radio-item">
                            <input type="radio" id="male" name="gender" value="male" required>
                            <label for="male">Male</label>
                        </div>
                        <div class="radio-item">
                            <input type="radio" id="female" name="gender" value="female" required>
                            <label for="female">Female</label>
                        </div>
                        <div class="radio-item">
                            <input type="radio" id="other" name="gender" value="other" required>
                            <label for="other">Other</label>
                        </div>
                    </div>
                    <div class="error-message" id="genderError">Please select a gender</div>
                </div>

                <div class="form-group">
                    <label for="patientPhoto">Patient Photo</label>
                    <div class="photo-upload" onclick="document.getElementById('patientPhoto').click()">
                        <input type="file" id="patientPhoto" name="patientPhoto" accept="image/*" onchange="previewPhoto(event)">
                        <p>📷 Click to upload patient photo</p>
                        <p style="font-size: 14px; color: #666; margin-top: 10px;">Optional - helps with patient identification</p>
                    </div>
                    <div class="photo-preview" id="photoPreview"></div>
                </div>
            </div>

            <!-- Contact Information -->
            <div class="form-section">
                <h2 class="section-title">📞 Contact Information</h2>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="phone">Phone Number <span class="required">*</span></label>
                        <input type="tel" id="phone" name="phone" placeholder="+1234567890" required>
                        <div class="error-message" id="phoneError">Phone number is required</div>
                    </div>
                    <div class="form-group">
                        <label for="email">Email Address</label>
                        <input type="email" id="email" name="email" placeholder="patient@example.com">
                    </div>
                </div>

                <div class="form-group">
                    <label for="address">Address <span class="required">*</span></label>
                    <textarea id="address" name="address" rows="3" placeholder="Enter full address" required></textarea>
                    <div class="error-message" id="addressError">Address is required</div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="city">City <span class="required">*</span></label>
                        <input type="text" id="city" name="city" required>
                        <div class="error-message" id="cityError">City is required</div>
                    </div>
                    <div class="form-group">
                        <label for="country">Country <span class="required">*</span></label>
                        <select id="country" name="country" required>
                            <option value="">Select Country</option>
                            <option value="nigeria">Nigeria</option>
                            <option value="ghana">Ghana</option>
                            <option value="kenya">Kenya</option>
                            <option value="south_africa">South Africa</option>
                            <option value="egypt">Egypt</option>
                            <option value="morocco">Morocco</option>
                            <option value="other">Other</option>
                        </select>
                        <div class="error-message" id="countryError">Country is required</div>
                    </div>
                </div>
            </div>

            <!-- Medical Information -->
            <div class="form-section">
                <h2 class="section-title">🏥 Medical Information</h2>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="bloodType">Blood Type</label>
                        <select id="bloodType" name="bloodType">
                            <option value="">Select Blood Type</option>
                            <option value="A+">A+</option>
                            <option value="A-">A-</option>
                            <option value="B+">B+</option>
                            <option value="B-">B-</option>
                            <option value="AB+">AB+</option>
                            <option value="AB-">AB-</option>
                            <option value="O+">O+</option>
                            <option value="O-">O-</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="height">Height (cm)</label>
                        <input type="number" id="height" name="height" placeholder="170">
                    </div>
                    <div class="form-group">
                        <label for="weight">Weight (kg)</label>
                        <input type="number" id="weight" name="weight" placeholder="70">
                    </div>
                </div>

                <div class="form-group">
                    <label>Known Allergies</label>
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input type="checkbox" id="penicillin" name="allergies" value="penicillin">
                            <label for="penicillin">Penicillin</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="aspirin" name="allergies" value="aspirin">
                            <label for="aspirin">Aspirin</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="latex" name="allergies" value="latex">
                            <label for="latex">Latex</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="food_allergies" name="allergies" value="food">
                            <label for="food_allergies">Food Allergies</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="no_allergies" name="allergies" value="none">
                            <label for="no_allergies">No Known Allergies</label>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label for="medicalHistory">Medical History</label>
                    <textarea id="medicalHistory" name="medicalHistory" rows="4" placeholder="Previous conditions, surgeries, chronic illnesses, etc."></textarea>
                </div>

                <div class="form-group">
                    <label for="currentMedications">Current Medications</label>
                    <textarea id="currentMedications" name="currentMedications" rows="3" placeholder="List current medications and dosages"></textarea>
                </div>
            </div>

            <!-- Current Symptoms & Chief Complaint -->
            <div class="form-section">
                <h2 class="section-title">🩺 Current Symptoms & Chief Complaint</h2>
                
                <div class="form-group">
                    <label for="chiefComplaint">Chief Complaint <span class="required">*</span></label>
                    <textarea id="chiefComplaint" name="chiefComplaint" rows="3" placeholder="What is the main reason for this visit? Describe the primary concern..." required></textarea>
                    <div class="error-message" id="chiefComplaintError">Chief complaint is required</div>
                </div>

                <div class="form-group">
                    <label>Current Symptoms (Select all that apply)</label>
                    <div class="symptoms-grid">
                        <!-- General Symptoms -->
                        <div class="symptom-category">
                            <h4>General</h4>
                            <div class="checkbox-item">
                                <input type="checkbox" id="fever" name="symptoms" value="fever">
                                <label for="fever">Fever</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="fatigue" name="symptoms" value="fatigue">
                                <label for="fatigue">Fatigue</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="weight_loss" name="symptoms" value="weight_loss">
                                <label for="weight_loss">Weight Loss</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="night_sweats" name="symptoms" value="night_sweats">
                                <label for="night_sweats">Night Sweats</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="chills" name="symptoms" value="chills">
                                <label for="chills">Chills</label>
                            </div>
                        </div>

                        <!-- Respiratory Symptoms -->
                        <div class="symptom-category">
                            <h4>Respiratory</h4>
                            <div class="checkbox-item">
                                <input type="checkbox" id="cough" name="symptoms" value="cough">
                                <label for="cough">Cough</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="persistent_cough" name="symptoms" value="persistent_cough">
                                <label for="persistent_cough">Persistent Cough (>3 weeks)</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="difficulty_breathing" name="symptoms" value="difficulty_breathing">
                                <label for="difficulty_breathing">Difficulty Breathing</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="chest_pain" name="symptoms" value="chest_pain">
                                <label for="chest_pain">Chest Pain</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="shortness_of_breath" name="symptoms" value="shortness_of_breath">
                                <label for="shortness_of_breath">Shortness of Breath</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="coughing_blood" name="symptoms" value="coughing_blood">
                                <label for="coughing_blood">Coughing Blood</label>
                            </div>
                        </div>

                        <!-- Gastrointestinal Symptoms -->
                        <div class="symptom-category">
                            <h4>Gastrointestinal</h4>
                            <div class="checkbox-item">
                                <input type="checkbox" id="nausea" name="symptoms" value="nausea">
                                <label for="nausea">Nausea</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="vomiting" name="symptoms" value="vomiting">
                                <label for="vomiting">Vomiting</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="diarrhea" name="symptoms" value="diarrhea">
                                <label for="diarrhea">Diarrhea</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="abdominal_pain" name="symptoms" value="abdominal_pain">
                                <label for="abdominal_pain">Abdominal Pain</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="loss_of_appetite" name="symptoms" value="loss_of_appetite">
                                <label for="loss_of_appetite">Loss of Appetite</label>
                            </div>
                        </div>

                        <!-- Neurological Symptoms -->
                        <div class="symptom-category">
                            <h4>Neurological</h4>
                            <div class="checkbox-item">
                                <input type="checkbox" id="headache" name="symptoms" value="headache">
                                <label for="headache">Headache</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="dizziness" name="symptoms" value="dizziness">
                                <label for="dizziness">Dizziness</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="confusion" name="symptoms" value="confusion">
                                <label for="confusion">Confusion</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="seizures" name="symptoms" value="seizures">
                                <label for="seizures">Seizures</label>
                            </div>
                        </div>

                        <!-- Other Symptoms -->
                        <div class="symptom-category">
                            <h4>Other</h4>
                            <div class="checkbox-item">
                                <input type="checkbox" id="joint_pain" name="symptoms" value="joint_pain">
                                <label for="joint_pain">Joint Pain</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="muscle_pain" name="symptoms" value="muscle_pain">
                                <label for="muscle_pain">Muscle Pain</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="skin_rash" name="symptoms" value="skin_rash">
                                <label for="skin_rash">Skin Rash</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="swollen_lymph_nodes" name="symptoms" value="swollen_lymph_nodes">
                                <label for="swollen_lymph_nodes">Swollen Lymph Nodes</label>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="symptomDuration">Symptom Duration</label>
                        <select id="symptomDuration" name="symptomDuration">
                            <option value="">Select Duration</option>
                            <option value="less_than_1_day">Less than 1 day</option>
                            <option value="1_3_days">1-3 days</option>
                            <option value="4_7_days">4-7 days</option>
                            <option value="1_2_weeks">1-2 weeks</option>
                            <option value="2_4_weeks">2-4 weeks</option>
                            <option value="more_than_1_month">More than 1 month</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="symptomSeverity">Symptom Severity (1-10)</label>
                        <input type="range" id="symptomSeverity" name="symptomSeverity" min="1" max="10" value="5">
                        <div class="severity-labels">
                            <span>Mild (1)</span>
                            <span id="severityValue">5</span>
                            <span>Severe (10)</span>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label for="additionalSymptoms">Additional Symptoms or Notes</label>
                    <textarea id="additionalSymptoms" name="additionalSymptoms" rows="3" placeholder="Describe any other symptoms or relevant information..."></textarea>
                </div>

                <div class="form-group">
                    <label>
                        <input type="checkbox" id="requestDiagnosis" name="requestDiagnosis" value="yes">
                        Request AI-powered diagnosis prediction based on symptoms
                    </label>
                    <p style="font-size: 14px; color: #666; margin-top: 5px;">
                        ℹ️ This will analyze the symptoms and provide preliminary diagnosis suggestions for healthcare provider review.
                    </p>
                </div>
            </div>

            <!-- Emergency Contact -->
            <div class="form-section emergency-contact">
                <h2 class="section-title">🚨 Emergency Contact</h2>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="emergencyName">Contact Name <span class="required">*</span></label>
                        <input type="text" id="emergencyName" name="emergencyName" required>
                        <div class="error-message" id="emergencyNameError">Emergency contact name is required</div>
                    </div>
                    <div class="form-group">
                        <label for="emergencyRelation">Relationship <span class="required">*</span></label>
                        <select id="emergencyRelation" name="emergencyRelation" required>
                            <option value="">Select Relationship</option>
                            <option value="spouse">Spouse</option>
                            <option value="parent">Parent</option>
                            <option value="child">Child</option>
                            <option value="sibling">Sibling</option>
                            <option value="friend">Friend</option>
                            <option value="other">Other</option>
                        </select>
                        <div class="error-message" id="emergencyRelationError">Relationship is required</div>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="emergencyPhone">Phone Number <span class="required">*</span></label>
                        <input type="tel" id="emergencyPhone" name="emergencyPhone" required>
                        <div class="error-message" id="emergencyPhoneError">Emergency contact phone is required</div>
                    </div>
                    <div class="form-group">
                        <label for="emergencyEmail">Email Address</label>
                        <input type="email" id="emergencyEmail" name="emergencyEmail">
                    </div>
                </div>
            </div>

            <!-- Submit Section -->
            <div class="submit-section">
                <button type="submit" class="submit-btn">✅ Register Patient</button>
                <a href="patients_screen.html" class="cancel-btn">❌ Cancel</a>
            </div>
        </form>
    </div>

    <!-- Navigation -->
    <div id="navigation-container"></div>

    <script>
        // Calculate age from date of birth
        document.getElementById('dateOfBirth').addEventListener('change', function() {
            const dob = new Date(this.value);
            const today = new Date();
            let age = today.getFullYear() - dob.getFullYear();
            const monthDiff = today.getMonth() - dob.getMonth();
            
            if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < dob.getDate())) {
                age--;
            }
            
            document.getElementById('age').value = age >= 0 ? age : '';
        });

        // Photo preview
        function previewPhoto(event) {
            const file = event.target.files[0];
            const preview = document.getElementById('photoPreview');
            
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    preview.innerHTML = `<img src="${e.target.result}" alt="Patient Photo">`;
                };
                reader.readAsDataURL(file);
            } else {
                preview.innerHTML = '';
            }
        }

        // Handle "No Known Allergies" checkbox
        document.getElementById('no_allergies').addEventListener('change', function() {
            const allergyCheckboxes = document.querySelectorAll('input[name="allergies"]:not(#no_allergies)');
            if (this.checked) {
                allergyCheckboxes.forEach(checkbox => {
                    checkbox.checked = false;
                    checkbox.disabled = true;
                });
            } else {
                allergyCheckboxes.forEach(checkbox => {
                    checkbox.disabled = false;
                });
            }
        });

        // Handle other allergy checkboxes
        document.querySelectorAll('input[name="allergies"]:not(#no_allergies)').forEach(checkbox => {
            checkbox.addEventListener('change', function() {
                if (this.checked) {
                    document.getElementById('no_allergies').checked = false;
                }
            });
        });

        // Handle severity slider
        document.getElementById('symptomSeverity').addEventListener('input', function() {
            document.getElementById('severityValue').textContent = this.value;
        });

        // Form validation
        function validateForm() {
            let isValid = true;
            const requiredFields = [
                'firstName', 'lastName', 'dateOfBirth', 'phone', 'address', 
                'city', 'country', 'emergencyName', 'emergencyRelation', 'emergencyPhone'
            ];

            // Clear previous errors
            document.querySelectorAll('.error-message').forEach(error => {
                error.style.display = 'none';
            });
            document.querySelectorAll('.error').forEach(field => {
                field.classList.remove('error');
            });

            // Validate required fields
            requiredFields.forEach(fieldName => {
                const field = document.getElementById(fieldName);
                if (!field.value.trim()) {
                    field.classList.add('error');
                    document.getElementById(fieldName + 'Error').style.display = 'block';
                    isValid = false;
                }
            });

            // Validate chief complaint
            const chiefComplaint = document.getElementById('chiefComplaint');
            if (!chiefComplaint.value.trim()) {
                chiefComplaint.classList.add('error');
                document.getElementById('chiefComplaintError').style.display = 'block';
                isValid = false;
            }

            // Validate gender
            const genderSelected = document.querySelector('input[name="gender"]:checked');
            if (!genderSelected) {
                document.getElementById('genderError').style.display = 'block';
                isValid = false;
            }

            // Validate email format
            const email = document.getElementById('email');
            if (email.value && !isValidEmail(email.value)) {
                email.classList.add('error');
                isValid = false;
            }

            const emergencyEmail = document.getElementById('emergencyEmail');
            if (emergencyEmail.value && !isValidEmail(emergencyEmail.value)) {
                emergencyEmail.classList.add('error');
                isValid = false;
            }

            return isValid;
        }

        function isValidEmail(email) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return emailRegex.test(email);
        }

        // Call diagnosis API
        async function callDiagnosisAPI(patientData) {
            const apiBaseUrl = 'http://localhost:8001/api/v1';
            
            // Prepare symptoms for API
            const symptomsText = patientData.symptoms.join(', ');
            const fullSymptomDescription = `${patientData.chiefComplaint}. Symptoms: ${symptomsText}. ${patientData.additionalSymptoms || ''}`.trim();
            
            // Prepare patient data for API
            const apiPayload = {
                symptoms: fullSymptomDescription,
                patient_data: {
                    age: parseInt(patientData.age) || null,
                    gender: patientData.gender || null,
                    temperature: null, // Could be added to form later
                    heart_rate: null,
                    respiratory_rate: null,
                    blood_pressure: null,
                    oxygen_saturation: null
                }
            };

            try {
                console.log('Calling diagnosis API with payload:', apiPayload);
                
                // Try enhanced prediction first
                const response = await fetch(`${apiBaseUrl}/predict/enhanced`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(apiPayload)
                });

                if (!response.ok) {
                    throw new Error(`API request failed: ${response.status} ${response.statusText}`);
                }

                const result = await response.json();
                console.log('Diagnosis API response:', result);
                
                return {
                    success: true,
                    disease_type: result.disease_type,
                    confidence: result.confidence,
                    diagnosis: result.diagnosis,
                    analyzed_symptoms: result.analyzed_symptoms,
                    diagnosis_details: result.diagnosis_details,
                    treatment_recommendations: result.treatment_recommendations,
                    specialist_referral: result.specialist_referral,
                    critical_indicators: result.critical_indicators,
                    timestamp: new Date().toISOString()
                };
                
            } catch (error) {
                console.error('Diagnosis API error:', error);
                
                // Fallback to general prediction if enhanced fails
                try {
                    const fallbackResponse = await fetch(`${apiBaseUrl}/predict/general`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(apiPayload)
                    });

                    if (fallbackResponse.ok) {
                        const fallbackResult = await fallbackResponse.json();
                        console.log('Fallback diagnosis API response:', fallbackResult);
                        
                        return {
                            success: true,
                            disease_type: fallbackResult.disease_type,
                            confidence: fallbackResult.confidence,
                            diagnosis: fallbackResult.diagnosis || 'General diagnosis completed',
                            analyzed_symptoms: fallbackResult.analyzed_symptoms,
                            diagnosis_details: fallbackResult.diagnosis_details,
                            treatment_recommendations: fallbackResult.treatment_recommendations || 'Please consult with a healthcare provider for treatment recommendations.',
                            specialist_referral: fallbackResult.specialist_referral,
                            critical_indicators: fallbackResult.critical_indicators,
                            timestamp: new Date().toISOString()
                        };
                    }
                } catch (fallbackError) {
                    console.error('Fallback diagnosis API error:', fallbackError);
                }
                
                throw new Error('Both enhanced and general diagnosis APIs failed');
            }
        }

        function submitForm(event) {
            event.preventDefault();
            
            if (!validateForm()) {
                alert('❌ Please fill in all required fields correctly.');
                return;
            }

            // Collect form data
            const formData = new FormData(event.target);
            const patientData = {};
            
            // Convert FormData to object
            for (let [key, value] of formData.entries()) {
                if (patientData[key]) {
                    if (Array.isArray(patientData[key])) {
                        patientData[key].push(value);
                    } else {
                        patientData[key] = [patientData[key], value];
                    }
                } else {
                    patientData[key] = value;
                }
            }

            // Handle allergies
            const allergies = [];
            document.querySelectorAll('input[name="allergies"]:checked').forEach(checkbox => {
                allergies.push(checkbox.value);
            });
            patientData.allergies = allergies;

            // Handle symptoms
            const symptoms = [];
            document.querySelectorAll('input[name="symptoms"]:checked').forEach(checkbox => {
                symptoms.push(checkbox.value);
            });
            patientData.symptoms = symptoms;
            
            // Add symptoms-related data
            patientData.chiefComplaint = document.getElementById('chiefComplaint').value;
            patientData.symptomDuration = document.getElementById('symptomDuration').value;
            patientData.symptomSeverity = document.getElementById('symptomSeverity').value;
            patientData.additionalSymptoms = document.getElementById('additionalSymptoms').value;
            patientData.requestDiagnosis = document.getElementById('requestDiagnosis').checked;

            // Generate patient ID
            patientData.patientId = 'P' + String(Date.now()).slice(-6);
            patientData.registrationDate = new Date().toISOString().split('T')[0];
            patientData.status = 'active';

            console.log('New Patient Data:', patientData);

            // Submit patient data
            const submitBtn = document.querySelector('.submit-btn');
            submitBtn.disabled = true;
            submitBtn.textContent = '⏳ Registering...';

            // Store patient data in localStorage for now (in real app, this would be sent to backend)
            const existingPatients = JSON.parse(localStorage.getItem('afridiag_patients') || '[]');
            existingPatients.push(patientData);
            localStorage.setItem('afridiag_patients', JSON.stringify(existingPatients));

            if (patientData.requestDiagnosis && patientData.symptoms.length > 0) {
                // If diagnosis is requested and symptoms are provided, call diagnosis API
                submitBtn.textContent = '🔍 Analyzing symptoms...';
                
                callDiagnosisAPI(patientData).then(diagnosisResult => {
                    // Store diagnosis result
                    patientData.diagnosisResult = diagnosisResult;
                    localStorage.setItem('afridiag_patients', JSON.stringify(existingPatients));
                    localStorage.setItem('current_diagnosis', JSON.stringify({
                        patient: patientData,
                        diagnosis: diagnosisResult
                    }));
                    
                    alert(`✅ Patient registered successfully with AI diagnosis!\n\nPatient ID: ${patientData.patientId}\nName: ${patientData.firstName} ${patientData.lastName}\n\nDiagnosis analysis completed. Redirecting to results...`);
                    
                    // Redirect to diagnosis screen with results
                    window.location.href = 'diagnosis_screen.html?patient=' + patientData.patientId;
                }).catch(error => {
                    console.error('Diagnosis API error:', error);
                    alert(`✅ Patient registered successfully!\n\nPatient ID: ${patientData.patientId}\nName: ${patientData.firstName} ${patientData.lastName}\n\n⚠️ Diagnosis analysis failed. You can request diagnosis later from the patient details.`);
                    
                    // Redirect to patients list
                    window.location.href = 'patients_screen.html';
                });
            } else {
                // No diagnosis requested, just register patient
                setTimeout(() => {
                    alert(`✅ Patient registered successfully!\n\nPatient ID: ${patientData.patientId}\nName: ${patientData.firstName} ${patientData.lastName}\n\nThe patient has been added to the system and can now be found in the patients list.`);
                    
                    // Redirect to patients list
                    window.location.href = 'patients_screen.html';
                }, 1500);
            }
        }

        // Real-time validation
        document.querySelectorAll('input, select, textarea').forEach(field => {
            field.addEventListener('blur', function() {
                if (this.hasAttribute('required') && !this.value.trim()) {
                    this.classList.add('error');
                    const errorElement = document.getElementById(this.id + 'Error');
                    if (errorElement) {
                        errorElement.style.display = 'block';
                    }
                } else {
                    this.classList.remove('error');
                    const errorElement = document.getElementById(this.id + 'Error');
                    if (errorElement) {
                        errorElement.style.display = 'none';
                    }
                }
            });
        });

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            console.log('➕ AfriDiag New Patient Registration loaded');
            
            // Initialize navigation with error handling
            try {
                if (typeof AfriDiagNavigation !== 'undefined') {
                    const navigation = new AfriDiagNavigation('navigation-container');
                    navigation.setActiveTab('new-patient');
                } else {
                    console.warn('AfriDiagNavigation class not found');
                }
            } catch (error) {
                console.error('Navigation initialization error:', error);
            }
        });
    </script>
</body>
</html>